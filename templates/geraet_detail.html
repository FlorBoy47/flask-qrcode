{% extends "layout.html" %}
{% block content %}
<h2>{{ geraet.name }}</h2>
<p>{{ geraet.beschreibung }}</p>

{% if user == "Admin" %}
<h3>Benutzereinträge:</h3>
<p><strong>Kunde:</strong> {{ notiz.kunde or "-" }}</p>
<p><strong>Problem gemeldet:</strong> {{ "Ja" if notiz.probleme else "Nein" }}</p>
{% if notiz.probleme %}
<p><strong>Problembeschreibung:</strong> {{ notiz.problembeschreibung or "-" }}</p>
{% endif %}
<p><strong>Sonstige Informationen:</strong> {{ notiz.info_user or "-" }}</p>

<hr>
<h3>Admin-Felder bearbeiten:</h3>
<form method="POST">
  <input type="hidden" name="admin_speichern" value="1">

  <label>Geliefert am:</label><br>
  <input type="text" name="geliefert_am" value="{{ admin_notiz.geliefert_am or '' }}"><br><br>

  <label>Infos zu Problemen:</label><br>
  <textarea name="info_problem_admin">{{ admin_notiz.info_problem_admin or '' }}</textarea><br><br>

  <label>Sonstige Informationen:</label><br>
  <textarea name="info_admin">{{ admin_notiz.info_admin or '' }}</textarea><br><br>

  {% if notiz and notiz.probleme %}
  <input type="checkbox" name="problem_behoben" id="problem_behoben"
         {% if notiz.problem_behoben %}checked{% endif %}>
  <label for="problem_behoben">Problem als behoben markieren</label><br><br>

  <label>Kommentar zur Behebung:</label><br>
  <textarea name="kommentar_behoben">{{ notiz.kommentar_behoben or '' }}</textarea><br><br>
  {% endif %}

  <button type="submit">Speichern</button>
</form>

{% else %}
<form method="POST">
  <input type="hidden" name="user_speichern" value="1">

  <label>Kunde:</label><br>
  <input type="text" name="kunde" value="{{ notiz.kunde or '' }}"><br><br>

  <input type="checkbox" id="probleme" name="probleme" value="1"
         {% if notiz and notiz.probleme %}checked{% endif %}
         onclick="toggleProblemfeld()">
  <label for="probleme">Problem vorhanden</label><br><br>

  <div id="problem_beschreibung_feld"
       style="display: {% if notiz and notiz.probleme %}block{% else %}none{% endif %};">
    <label>Problembeschreibung:</label><br>
    <textarea name="problembeschreibung">{{ notiz.problembeschreibung or '' }}</textarea><br><br>
  </div>

  <label>Sonstige Informationen:</label><br>
  <textarea name="info_user">{{ notiz.info_user or '' }}</textarea><br><br>

  <button type="submit">Speichern</button>
</form>

{% if notiz and notiz.problem_behoben %}
<hr>
<h3>Status:</h3>
<p><strong>Problem wurde als behoben markiert.</strong></p>
<p><strong>Kommentar vom Admin:</strong><br>{{ notiz.kommentar_behoben or "-" }}</p>
{% endif %}
{% endif %}

<br><a href="{{ url_for('geraete_liste') }}">Zurück zur Übersicht</a>

<script>
  function toggleProblemfeld() {
    const checkbox = document.getElementById("probleme");
    const beschreibung = document.getElementById("problem_beschreibung_feld");
    beschreibung.style.display = checkbox.checked ? "block" : "none";
  }
</script>
{% endblock %}
